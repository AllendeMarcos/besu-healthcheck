process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = 0;
const Web3 = require('web3');
const Tx = require("ethereumjs-tx");
const mnid = require('mnid');
var web3 = new Web3(new Web3.providers.HttpProvider(process.env.RPC_URL));
const address = '0x75F4149c9E403ecbcf15ceeA796C85489b567Fe4';
let count = web3.eth.getTransactionCount(address);
console.log(count);
//console.log(web3.toHex(web3.version.network));

//Deploy Coupon
var contract = web3.eth.contract([{"constant":false,"inputs":[{"name":"user","type":"address"},{"name":"role","type":"string"}],"name":"removeRole","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"},{"name":"role","type":"string"}],"name":"hasRole","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32"},{"name":"validDays","type":"uint256"},{"name":"identityManager","type":"address"},{"name":"verificationRegistry","type":"address"}],"name":"approveAEO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32"},{"name":"identityManager","type":"address"},{"name":"verificationRegistry","type":"address"}],"name":"revokeAEO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32"}],"name":"registerAEO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"},{"name":"role","type":"string"}],"name":"addRole","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"registryAEO","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"proxy","type":"address"},{"name":"firstAdmin","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"hash","type":"bytes32"},{"indexed":false,"name":"user","type":"address"}],"name":"RegisteredAEO","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"hash","type":"bytes32"},{"indexed":false,"name":"user","type":"address"}],"name":"ApprovedAEO","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"hash","type":"bytes32"},{"indexed":false,"name":"user","type":"address"}],"name":"RevokedAEO","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"user","type":"address"},{"indexed":false,"name":"role","type":"string"}],"name":"RoleAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"user","type":"address"},{"indexed":false,"name":"role","type":"string"}],"name":"RoleRemoved","type":"event"}]);
var dataToSend = contract.new.getData("0x587a264f7a203f12a09bfd3190777e0eab3032f5", "0xc0d05b60a75f8acd8b2f9f1c2a3a6bc58a3da23f", {
	data: '0x60806040526040805190810160405280600681526020017f524f4c455f31000000000000000000000000000000000000000000000000000081525060009080519060200190620000519291906200023e565b506040805190810160405280600681526020017f524f4c455f320000000000000000000000000000000000000000000000000000815250600190805190602001906200009f9291906200023e565b506040805190810160405280600681526020017f524f4c455f33000000000000000000000000000000000000000000000000000081525060029080519060200190620000ed9291906200023e565b50348015620000fb57600080fd5b5060405160408062001d0d833981018060405281019080805190602001909291908051906020019092919050505081600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060405180828054600181600116156101000203166002900480156200020c5780601f10620001e95761010080835404028352918201916200020c565b820191906000526020600020905b815481529060010190602001808311620001f7575b5050915050908152602001604051809103902060006101000a81548160ff0219169083151502179055505050620002ed565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200028157805160ff1916838001178555620002b2565b82800160010185558215620002b2579182015b82811115620002b157825182559160200191906001019062000294565b5b509050620002c19190620002c5565b5090565b620002ea91905b80821115620002e6576000816000905550600101620002cc565b5090565b90565b611a1080620002fd6000396000f300608060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631bfe030814610088578063217fe6c6146101115780632a8dfab3146101b257806340a55d451461022d578063759e7c981461029e5780637d72aa65146102cf578063939e2d0414610358575b600080fd5b34801561009457600080fd5b5061010f600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506103a1565b005b34801561011d57600080fd5b50610198600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610826565b604051808215151515815260200191505060405180910390f35b3480156101be57600080fd5b5061022b600480360381019080803560001916906020019092919080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506108e6565b005b34801561023957600080fd5b5061029c6004803603810190808035600019169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610dde565b005b3480156102aa57600080fd5b506102cd6004803603810190808035600019169060200190929190505050611230565b005b3480156102db57600080fd5b50610356600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929050505061153e565b005b34801561036457600080fd5b5061038760048036038101908080356000191690602001909291905050506119c4565b604051808215151515815260200191505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104375780601f1061040c57610100808354040283529160200191610437565b820191906000526020600020905b81548152906001019060200180831161041a57829003601f168201915b5050505050600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020816040518082805190602001908083835b6020831015156104b1578051825260208201915060208101905060208303925061048c565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515610566576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420726f6c6520666f722075736572000000000000000000000081525060200191505060405180910390fd5b600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020826040518082805190602001908083835b6020831015156105db57805182526020820191506020810190506020830392506105b6565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515610690576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260148152602001807f726f6c6520616c72656164792072656d6f76656400000000000000000000000081525060200191505060405180910390fd5b6000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020836040518082805190602001908083835b60208310151561070757805182526020820191506020810190506020830392506106e2565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a81548160ff0219169083151502179055507fd211483f91fc6eff862467f8de606587a30c8fc9981056f051b897a418df803a8383604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001828103825283818151815260200191508051906020019080838360005b838110156107e65780820151818401526020810190506107cb565b50505050905090810190601f1680156108135780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1505050565b6000600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020826040518082805190602001908083835b60208310151561089d5780518252602082019150602081019050602083039250610878565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff16905092915050565b60028054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561097c5780601f106109515761010080835404028352916020019161097c565b820191906000526020600020905b81548152906001019060200180831161095f57829003601f168201915b5050505050600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020816040518082805190602001908083835b6020831015156109f657805182526020820191506020810190506020830392506109d1565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515610aab576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420726f6c6520666f722075736572000000000000000000000081525060200191505060405180910390fd5b60046000866000191660001916815260200190815260200160002060009054906101000a900460ff161515610b48576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260128152602001807f41454f206e6f742072656769737465726564000000000000000000000000000081525060200191505060405180910390fd5b8273ffffffffffffffffffffffffffffffffffffffff166373b40a5c600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168460008989604051602401808360001916600019168152602001828152602001925050506040516020818303038152906040527f382262fc000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040518563ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610cfd578082015181840152602081019050610ce2565b50505050905090810190601f168015610d2a5780820380516001836020036101000a031916815260200191505b5095505050505050600060405180830381600087803b158015610d4c57600080fd5b505af1158015610d60573d6000803e3d6000fd5b505050507f6e0ae1afa4f33ad7db8e7ba62ead03c847974fc6ae37ce0134888e25b2fc6ef485336040518083600019166000191681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019250505060405180910390a15050505050565b60028054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e745780601f10610e4957610100808354040283529160200191610e74565b820191906000526020600020905b815481529060010190602001808311610e5757829003601f168201915b5050505050600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020816040518082805190602001908083835b602083101515610eee5780518252602082019150602081019050602083039250610ec9565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515610fa3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420726f6c6520666f722075736572000000000000000000000081525060200191505060405180910390fd5b8273ffffffffffffffffffffffffffffffffffffffff166373b40a5c600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16846000886040516024018082600019166000191681526020019150506040516020818303038152906040527fb75c7dc6000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040518563ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015611150578082015181840152602081019050611135565b50505050905090810190601f16801561117d5780820380516001836020036101000a031916815260200191505b5095505050505050600060405180830381600087803b15801561119f57600080fd5b505af11580156111b3573d6000803e3d6000fd5b505050507f71f95262377fe41184d9682b9791d48c4a5fc89ca3c1fd9ce3031b6a8c1d80e484336040518083600019166000191681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019250505060405180910390a150505050565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112c65780601f1061129b576101008083540402835291602001916112c6565b820191906000526020600020905b8154815290600101906020018083116112a957829003601f168201915b5050505050600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020816040518082805190602001908083835b602083101515611340578051825260208201915060208101905060208303925061131b565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff1615156113f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420726f6c6520666f722075736572000000000000000000000081525060200191505060405180910390fd5b60046000836000191660001916815260200190815260200160002060009054906101000a900460ff16151515611493576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260168152602001807f41454f20616c726561647920726567697374657265640000000000000000000081525060200191505060405180910390fd5b600160046000846000191660001916815260200190815260200160002060006101000a81548160ff0219169083151502179055507f40219468246a97885c6991fe9a0abb13aeca76e827d965448cbc1b2713557ae182336040518083600019166000191681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019250505060405180910390a15050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115d45780601f106115a9576101008083540402835291602001916115d4565b820191906000526020600020905b8154815290600101906020018083116115b757829003601f168201915b5050505050600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020816040518082805190602001908083835b60208310151561164e5780518252602082019150602081019050602083039250611629565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515611703576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420726f6c6520666f722075736572000000000000000000000081525060200191505060405180910390fd5b600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020826040518082805190602001908083835b6020831015156117785780518252602082019150602081019050602083039250611753565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff1615151561182e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260128152602001807f726f6c6520616c7265616479206164646564000000000000000000000000000081525060200191505060405180910390fd5b6001600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020836040518082805190602001908083835b6020831015156118a55780518252602082019150602081019050602083039250611880565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a81548160ff0219169083151502179055507fbfec83d64eaa953f2708271a023ab9ee82057f8f3578d548c1a4ba0b5b7004898383604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001828103825283818151815260200191508051906020019080838360005b83811015611984578082015181840152602081019050611969565b50505050905090810190601f1680156119b15780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1505050565b60046020528060005260406000206000915054906101000a900460ff16815600a165627a7a723058207889573148e1fb5bde2b5b9918067898e1af7a1fd95ce86ebaba6ba8c0aad1270029'
});


var rawTx = {
  from: address,
  //gas: web3.toHex(0),
  gasPrice: web3.toHex(0),
  gasLimit: web3.toHex(800000),
  nonce: web3.toHex(count),
  data: dataToSend,
  //to: "0x6b8ba9acf40258c0f6cefd910736d8a4f495afea"
}

let tempPrivateKey = '547df43fdd4d3a85a7191e2b7076ffdb63a7d36a4d3351407726f93b4392fcbc';
let pk = Buffer.from(tempPrivateKey, "hex");
let tx = new Tx(rawTx);
tx.sign(pk);
let serializedTx = tx.serialize();
let dataSigned = "0x" + serializedTx.toString("hex");


web3.eth.sendRawTransaction(dataSigned, function(error, hash) {
  console.log(error);
  if (!error) console.log(hash);
  setTimeout(() => {
	  let receipt = web3.eth.getTransactionReceipt(hash);
	  console.log(receipt);
  	
  }, 10000);
})